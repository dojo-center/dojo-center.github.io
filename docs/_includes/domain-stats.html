{% if domain %}
  {% assign dis = [domain | downcase] %}
  {% if domain.label %}
    {% assign dis = [domain.label | downcase] %}
  {% endif %}

  <!-- Filter active domain members -->
  {% assign domain_members_all = site.data.members | where_exp: "member", "member.belts[dis] != nil" %}
  {% assign domain_members = domain_members_all | where_exp: "member", "member.inactive != true" %}

  <!-- Initialize the belt totals for the current domain -->
  {% assign belt_totals = {} %}
  {% for belt in site.beltLevels %}
    {% assign belt_totals = belt_totals | merge: { belt.value: 0 } %}
  {% endfor %}

  <!-- Calculate the total number of belts for each level in this domain -->
  {% for belt in site.beltLevels %}
    <!-- Get members holding the current belt -->
    {% assign members_with_belt = domain_members | where_exp: "member", "member.belts[dis] contains belt.value" %}
    {% assign belt_count = members_with_belt | size %}
    
    <!-- Add current belt holders to this belt level -->
    {% assign belt_totals = belt_totals | merge: { belt.value: belt_totals[belt.value] | plus: belt_count } %}

  {% endfor %}

  <!-- Calculate total belts granted -->
  {% assign total_count = 0 %}
  {% for belt in site.beltLevels %}
    {% assign total_count = total_count | plus: belt_totals[belt.value] %}
  {% endfor %}

  <div class="col-md-4 col-sm-12">
    <div class="card bg-secondary mb-3">
      {% if show_domain %}
        <div class="card-header">{{ dis | capitalize }}</div>
      {% endif %}
      <div class="card-body">
        <h5 class="card-title">Belt Claims</h5>
      </div>
      <ul class="list-group list-group-flush">

        <!-- Member count -->
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <span><a href="{{ '/Members' | relative_url }}">Member</a> Count</span>
          <span class="badge badge-warning badge-pill">{{ domain_members | size }}</span>
        </li>

        <!-- Dynamically render belt levels and totals -->
        {% for belt in site.beltLevels %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <img src="images/belt-{{ belt.value }}.png" height="30">
            <span class="badge badge-primary badge-pill">{{ belt_totals[belt.value] }}</span>
          </li>
        {% endfor %}

        <!-- Total Belts Granted -->
        <li class="list-group-item d-flex justify-content-between align-items-center">
          Total Belts Granted
          <span class="badge badge-danger badge-pill">{{ total_count }}</span>
        </li>

      </ul>
    </div>
  </div>
{% else %}
  <div class="alert alert-dismissible alert-danger">
    <button type="button" class="close" data-dismiss="alert">&times;</button>
    <strong>No stats available for this Domain!</strong>
  </div>
{% endif %}
